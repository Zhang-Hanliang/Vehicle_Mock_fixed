# ğŸš€ Vehicle Mock éƒ¨ç½²æŒ‡å—

## ğŸ“‹ éƒ¨ç½²é…ç½®å‚è€ƒ

åœ¨OWA5Xè®¾å¤‡çš„ docker-compose.yml ä¸­ï¼Œä½ æœ‰ä¸‰ç§æ ‡ç­¾ç­–ç•¥å¯é€‰ï¼š

### **é€‰é¡¹1ï¼šä½¿ç”¨å›ºå®šç‰ˆæœ¬æ ‡ç­¾ v001armï¼ˆå½“å‰æ–¹å¼ï¼‰**
```yaml
services:
  vehicle-mock:
    image: ghcr.io/zhang-hanliang/vehicle_mock_fixed/vehicle-mock:v001arm
    restart: always
```

**ä¼˜ç‚¹ï¼š**
- ç‰ˆæœ¬å›ºå®šï¼Œä¸ä¼šè‡ªåŠ¨æ›´æ–°
- ç”Ÿäº§ç¯å¢ƒç¨³å®š

**ç¼ºç‚¹ï¼š**
- éœ€è¦æ‰‹åŠ¨å¼ºåˆ¶æ‹‰å–æ–°é•œåƒ
- åŒåæ ‡ç­¾ä¼šæœ‰ç¼“å­˜é—®é¢˜

**æ›´æ–°æ–¹æ³•ï¼š**
```bash
docker compose down
docker rmi ghcr.io/zhang-hanliang/vehicle_mock_fixed/vehicle-mock:v001arm
docker compose up -d --pull always
```

---

### **é€‰é¡¹2ï¼šä½¿ç”¨ latest æ ‡ç­¾ï¼ˆæ¨èå¼€å‘/æµ‹è¯•ï¼‰**
```yaml
services:
  vehicle-mock:
    image: ghcr.io/zhang-hanliang/vehicle_mock_fixed/vehicle-mock:latest
    restart: always
    pull_policy: always  # Docker Compose v2.0+
```

**ä¼˜ç‚¹ï¼š**
- æ€»æ˜¯è·å–æœ€æ–°æ„å»º
- ä¸éœ€è¦æ‰‹åŠ¨åˆ é™¤é•œåƒ

**ç¼ºç‚¹ï¼š**
- æ¯æ¬¡é‡å¯éƒ½ä¼šæ£€æŸ¥æ›´æ–°ï¼ˆç¨æ…¢ï¼‰
- å¯èƒ½å¼•å…¥æœªé¢„æœŸçš„å˜æ›´

**æ›´æ–°æ–¹æ³•ï¼š**
```bash
docker compose down
docker compose up -d --pull always
```

---

### **é€‰é¡¹3ï¼šä½¿ç”¨ Git SHA æ ‡ç­¾ï¼ˆæ¨èç”Ÿäº§ç¯å¢ƒï¼‰**
```yaml
services:
  vehicle-mock:
    # ä½¿ç”¨ç‰¹å®šçš„commit SHAï¼Œç¡®ä¿ç»å¯¹çš„å¯è¿½æº¯æ€§
    image: ghcr.io/zhang-hanliang/vehicle_mock_fixed/vehicle-mock:868dc93abcdef...
    restart: always
```

**ä¼˜ç‚¹ï¼š**
- å®Œå…¨å¯è¿½æº¯ï¼ŒçŸ¥é“è¿è¡Œçš„æ˜¯å“ªä¸ªcommit
- ä¸ä¼šæœ‰ç¼“å­˜é—®é¢˜ï¼ˆæ¯ä¸ªSHAéƒ½æ˜¯å”¯ä¸€çš„ï¼‰
- ç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µ

**ç¼ºç‚¹ï¼š**
- éœ€è¦æ‰‹åŠ¨æ›´æ–°SHAå€¼

**æ›´æ–°æ–¹æ³•ï¼š**
```bash
# 1. åœ¨GitHub Actionsé¡µé¢æŸ¥çœ‹æœ€æ–°æ„å»ºçš„commit SHA
# 2. æ›´æ–°docker-compose.ymlä¸­çš„SHAæ ‡ç­¾
# 3. é‡æ–°éƒ¨ç½²
docker compose up -d
```

---

## ğŸ¯ æ¨èçš„å®Œæ•´ docker-compose.yml é…ç½®

```yaml
version: '3.8'

services:
  vehicle-mock:
    image: ghcr.io/zhang-hanliang/vehicle_mock_fixed/vehicle-mock:latest
    container_name: debian-vehicle-mock-1
    restart: always
    pull_policy: always  # ç¡®ä¿æ€»æ˜¯æ£€æŸ¥æ›´æ–°
    environment:
      - DAPR_GRPC_PORT=${DAPR_GRPC_PORT:-50001}
      - VEHICLEDATABROKER_DAPR_APP_ID=${VEHICLEDATABROKER_DAPR_APP_ID:-vehicledatabroker}
    volumes:
      - /etc/ccu-applet/ccu-applet.log:/var/log/ccu-applet.log
    networks:
      - ccu-network

networks:
  ccu-network:
    external: true
```

---

## ğŸ”„ å¿«é€Ÿæ›´æ–°è„šæœ¬

åˆ›å»ºä¸€ä¸ªä¾¿æ·çš„æ›´æ–°è„šæœ¬ `update-vehicle-mock.sh`ï¼š

```bash
#!/bin/bash
# update-vehicle-mock.sh

echo "ğŸ”„ Updating vehicle-mock..."

# åœæ­¢å®¹å™¨
echo "ğŸ“¦ Stopping container..."
docker compose down

# åˆ é™¤æ—§é•œåƒ
echo "ğŸ—‘ï¸  Removing old image..."
docker rmi ghcr.io/zhang-hanliang/vehicle_mock_fixed/vehicle-mock:latest 2>/dev/null || true

# æ‹‰å–æœ€æ–°é•œåƒ
echo "â¬‡ï¸  Pulling latest image..."
docker pull ghcr.io/zhang-hanliang/vehicle_mock_fixed/vehicle-mock:latest

# å¯åŠ¨å®¹å™¨
echo "ğŸš€ Starting container..."
docker compose up -d

# æ˜¾ç¤ºæ—¥å¿—
echo "ğŸ“‹ Showing logs..."
sleep 2
docker logs --tail 50 -f debian-vehicle-mock-1
```

ä½¿ç”¨æ–¹æ³•ï¼š
```bash
chmod +x update-vehicle-mock.sh
./update-vehicle-mock.sh
```

---

## ğŸ“Š é•œåƒæ ‡ç­¾è¯´æ˜

ç°åœ¨GitHub Actionsä¼šä¸ºæ¯æ¬¡æ„å»ºç”Ÿæˆä¸‰ä¸ªæ ‡ç­¾ï¼š

1. **`v001arm`** - å›ºå®šç‰ˆæœ¬æ ‡ç­¾ï¼ˆè¦†ç›–å¼æ›´æ–°ï¼‰
2. **`latest`** - æ°¸è¿œæŒ‡å‘æœ€æ–°æ„å»º
3. **`<git-sha>`** - æ¯ä¸ªcommitçš„å”¯ä¸€æ ‡ç­¾ï¼ˆå¦‚`868dc93`ï¼‰

ä½ å¯ä»¥åœ¨GitHub Packagesé¡µé¢çœ‹åˆ°æ‰€æœ‰æ ‡ç­¾ï¼š
https://github.com/Zhang-Hanliang/Vehicle_Mock_fixed/pkgs/container/vehicle-mock

---

## âœ… å½“å‰æ¨èæ–¹æ¡ˆ

**å¯¹äºä½ çš„æƒ…å†µï¼Œæˆ‘æ¨èï¼š**

1. **ç«‹å³æ“ä½œï¼ˆè§£å†³å½“å‰é—®é¢˜ï¼‰ï¼š**
   ```bash
   docker compose down
   docker rmi ghcr.io/zhang-hanliang/vehicle_mock_fixed/vehicle-mock:v001arm
   docker compose up -d --pull always
   ```

2. **é•¿æœŸæ–¹æ¡ˆï¼ˆä¿®æ”¹docker-compose.ymlï¼‰ï¼š**
   - æ”¹ç”¨ `latest` æ ‡ç­¾
   - æ·»åŠ  `pull_policy: always`
   - è¿™æ ·æ¯æ¬¡ `docker compose up -d` éƒ½ä¼šè‡ªåŠ¨æ£€æŸ¥æ›´æ–°

---

## ğŸ› æ•…éšœæ’æŸ¥

å¦‚æœæ›´æ–°åä»ç„¶æŠ¥é”™ï¼Œè¯·æ£€æŸ¥ï¼š

```bash
# 1. ç¡®è®¤æ‹‰å–çš„æ˜¯æœ€æ–°é•œåƒ
docker images | grep vehicle-mock

# 2. æ£€æŸ¥é•œåƒåˆ›å»ºæ—¶é—´ï¼ˆåº”è¯¥æ˜¯æœ€è¿‘çš„ï¼‰
docker inspect ghcr.io/zhang-hanliang/vehicle_mock_fixed/vehicle-mock:latest | grep Created

# 3. æŸ¥çœ‹å®¹å™¨æ—¥å¿—
docker logs --tail 100 debian-vehicle-mock-1

# 4. å¦‚æœè¿˜æ˜¯æœ‰é—®é¢˜ï¼Œæ£€æŸ¥GitHub Actionsæ„å»ºçŠ¶æ€
# è®¿é—®: https://github.com/Zhang-Hanliang/Vehicle_Mock_fixed/actions
```
